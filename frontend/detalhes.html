<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Encantaria ‚Äî Detalhes</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header">
    <div class="logo">Encantaria</div>
    <nav class="nav">
      <a href="index.html">home</a>
      <a href="recem-chegados.html">voltar</a>
    </nav>
  </header>

  <main class="container">
    <div id="loading" style="text-align:center; padding:40px;">Carregando detalhes...</div>

    <div id="content" style="display:none;">
      <div class="hero" style="background: white; border:1px solid #ddd; box-shadow:0 4px 12px rgba(0,0,0,0.05);">
        <div style="display:flex; flex-wrap:wrap; gap:30px;">
          
          <div style="flex:1; min-width:300px;">
            <img id="img-destaque" src="" style="width:100%; border-radius:8px; object-fit:cover; max-height:400px;" />
          </div>

          <div style="flex:1.5; display:flex; flex-direction:column; justify-content:center;">
            
            <div>
              <span id="categoria-badge" style="background:var(--accent); color:white; padding:4px 12px; border-radius:12px; font-size:12px; text-transform:uppercase; letter-spacing:0.5px;"></span>
              <span id="tipo-badge" style="background:#eee; color:#333; padding:4px 12px; border-radius:12px; font-size:12px; margin-left:8px;"></span>
            </div>
            
            <h2 id="titulo" style="margin:15px 0 10px 0; font-size:32px; font-family:'Georgia', serif;"></h2>
            
            <p style="color:#666; margin-bottom:20px; font-size:15px;">
              üìç <span id="cidade"></span> - <span id="estado"></span>
            </p>

            <div style="background:#f9f9f9; padding:20px; border-radius:8px; margin-bottom:20px;">
              <h4 style="margin-top:0;">Sobre:</h4>
              <p id="descricao" style="line-height:1.6; color:#333; white-space: pre-wrap;"></p>
            </div>

            <div style="margin-top:auto;">
              <p style="font-size:14px; color:#555;">Publicado por: <strong id="autor-nome">...</strong></p>
              <button class="btn" onclick="alert('Funcionalidade de chat em breve!')">Entrar em Contato</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    async function carregarDetalhes() {
      // 1. Pega o ID da URL (?id=1)
      const params = new URLSearchParams(window.location.search);
      const id = parseInt(params.get('id'));

      if(!id) {
        document.getElementById('loading').innerText = "An√∫ncio n√£o especificado.";
        return;
      }

      try {
        // Busca an√∫ncios e usu√°rios para cruzar dados
        const [resAnuncios, resUsuarios] = await Promise.all([
          fetch('/anuncios'),
          fetch('/usuarios')
        ]);

        const listaAnuncios = await resAnuncios.json();
        const listaUsuarios = await resUsuarios.json();

        // Encontra o an√∫ncio
        const anuncio = listaAnuncios.find(a => a.id === id);

        if(!anuncio) {
          document.getElementById('loading').innerText = "An√∫ncio n√£o encontrado.";
          return;
        }

        // Encontra o dono do an√∫ncio
        const autor = listaUsuarios.find(u => u.id === anuncio.usuario_id);

        // Preenche a tela
        document.getElementById('titulo').innerText = anuncio.titulo;
        document.getElementById('descricao').innerText = anuncio.descricao;
        document.getElementById('categoria-badge').innerText = anuncio.categoria;
        document.getElementById('tipo-badge').innerText = anuncio.tipo === 'oferece' ? 'Oferta' : 'Procura';
        document.getElementById('cidade').innerText = anuncio.cidade;
        document.getElementById('estado').innerText = anuncio.estado;
        
        // Imagem aleat√≥ria consistente
        document.getElementById('img-destaque').src = `https://picsum.photos/seed/encantaria${anuncio.id}/800/500`;

        if(autor) {
          document.getElementById('autor-nome').innerText = autor.nome;
        } else {
          document.getElementById('autor-nome').innerText = "Usu√°rio da Encantaria";
        }

        // Mostra conte√∫do
        document.getElementById('loading').style.display = 'none';
        document.getElementById('content').style.display = 'block';

      } catch(e) {
        console.error(e);
        document.getElementById('loading').innerText = "Erro ao carregar dados. Verifique sua conex√£o.";
      }
    }

    carregarDetalhes();
  </script>
</body>
</html>