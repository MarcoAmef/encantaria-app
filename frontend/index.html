<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Encantaria - Protótipo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button, textarea { margin: 5px 0; padding: 5px; width: 300px; }
    hr { margin: 20px 0; }
  </style>
</head>
<body>
  <h1>Encantaria - Protótipo</h1>

  <!-- Registro -->
  <h2>Registrar Usuário</h2>
  <input type="text" id="reg_nome" placeholder="Nome"><br>
  <input type="email" id="reg_email" placeholder="Email"><br>
  <input type="password" id="reg_senha" placeholder="Senha"><br>
  <button onclick="registrar()">Registrar</button>
  <p id="reg_msg"></p>
  <hr>

  <!-- Login -->
  <h2>Login</h2>
  <input type="email" id="login_email" placeholder="Email"><br>
  <input type="password" id="login_senha" placeholder="Senha"><br>
  <button onclick="logar()">Login</button>
  <p id="login_msg"></p>
  <hr>

  <!-- Usuários -->
  <h2>Lista de Usuários</h2>
  <button onclick="listarUsuarios()">Atualizar Lista</button>
  <ul id="usuarios_list"></ul>
  <hr>

  <!-- Anúncios -->
  <h2>Criar Anúncio</h2>
  <input type="text" id="anuncio_titulo" placeholder="Título"><br>
  <textarea id="anuncio_descricao" placeholder="Descrição"></textarea><br>
  <input type="text" id="anuncio_categoria" placeholder="Categoria"><br>
  <input type="text" id="anuncio_tipo" placeholder="Tipo (oferece/procura)"><br>
  <button onclick="criarAnuncio()">Criar Anúncio</button>
  <p id="anuncio_msg"></p>
  <hr>

  <h2>Lista de Anúncios</h2>
  <button onclick="listarAnuncios()">Atualizar Anúncios</button>
  <ul id="anuncios_list"></ul>

  <script>
    let token = "";

    async function registrar() {
      const res = await fetch('http://127.0.0.1:5000/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          nome: document.getElementById('reg_nome').value,
          email: document.getElementById('reg_email').value,
          senha: document.getElementById('reg_senha').value
        })
      });
      const data = await res.json();
      document.getElementById('reg_msg').innerText = JSON.stringify(data);
    }

    async function logar() {
      const res = await fetch('http://127.0.0.1:5000/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: document.getElementById('login_email').value,
          senha: document.getElementById('login_senha').value
        })
      });
      const data = await res.json();
      if(data.token){
        token = data.token;
        document.getElementById('login_msg').innerText = "Login realizado com sucesso!";
      } else {
        document.getElementById('login_msg').innerText = JSON.stringify(data);
      }
    }

    async function listarUsuarios() {
      const res = await fetch('http://127.0.0.1:5000/usuarios');
      const data = await res.json();
      const ul = document.getElementById('usuarios_list');
      ul.innerHTML = "";
      data.forEach(u => {
        const li = document.createElement('li');
        li.innerText = `${u.nome} (${u.email}) - ${u.tipo_usuario}`;
        ul.appendChild(li);
      });
    }

    async function criarAnuncio() {
      if(!token){
        alert("Faça login antes de criar anúncio!");
        return;
      }
      const res = await fetch('http://127.0.0.1:5000/anuncios', {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'Authorization': token
        },
        body: JSON.stringify({
          titulo: document.getElementById('anuncio_titulo').value,
          descricao: document.getElementById('anuncio_descricao').value,
          categoria: document.getElementById('anuncio_categoria').value,
          tipo: document.getElementById('anuncio_tipo').value
        })
      });
      const data = await res.json();
      document.getElementById('anuncio_msg').innerText = JSON.stringify(data);
    }

    async function listarAnuncios() {
      const res = await fetch('http://127.0.0.1:5000/anuncios');
      const data = await res.json();
      const ul = document.getElementById('anuncios_list');
      ul.innerHTML = "";
      data.forEach(a => {
        const li = document.createElement('li');
        li.innerText = `[${a.tipo}] ${a.titulo} - ${a.descricao}`;
        ul.appendChild(li);
      });
    }
  </script>
</body>
</html>
